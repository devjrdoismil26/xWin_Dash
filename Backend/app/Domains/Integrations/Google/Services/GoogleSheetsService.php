<?php\n\nnamespace App\\Domains\\Integrations\\Google\\Services;\n\nuse Google\\Client; // Supondo que a biblioteca Google API Client esteja instalada\nuse Google\\Service\\Sheets; // Supondo que a biblioteca Google API Client esteja instalada\nuse Illuminate\\Support\\Facades\\Log;\n\nclass GoogleSheetsService\n{\n    protected Client $client;\n    protected Sheets $sheetsService;\n\n    public function __construct()\n    {\n        $this->client = new Client();\n        $this->client->setApplicationName(\'xWin Dash\');\n        $this->client->setScopes([Sheets::SPREADSHEETS]);\n        $this->client->setAuthConfig(config(\'services.google.credentials_path\')); // Caminho para o arquivo credentials.json\n        $this->sheetsService = new Sheets($this->client);\n    }\n\n    /**\n     * Lê um intervalo de células de uma planilha.\n     *\n     * @param string $spreadsheetId O ID da planilha.\n     * @param string $range O intervalo de células (ex: \'Sheet1!A1:B10\').\n     * @return array Os valores das células.\n     * @throws \\Exception Se a leitura falhar.\n     */\n    public function readSheetRange(string $spreadsheetId, string $range): array\n    {\n        Log::info(\"Lendo dados do Google Sheets: Planilha ID {$spreadsheetId}, Range: {$range}.\");\n        try {\n            $response = $this->sheetsService->spreadsheets_values->get($spreadsheetId, $range);\n            return $response->getValues() ?? [];\n        } catch (\\Exception $e) {\n            Log::error(\"Falha ao ler dados do Google Sheets: \" . $e->getMessage());\n            throw $e;\n        }\n    }\n\n    /**\n     * Escreve dados em um intervalo de células de uma planilha.\n     *\n     * @param string $spreadsheetId O ID da planilha.\n     * @param string $range O intervalo de células (ex: \'Sheet1!A1\').\n     * @param array $values Os valores a serem escritos (array de arrays).\n     * @return bool\n     * @throws \\Exception Se a escrita falhar.\n     */\n    public function writeSheetRange(string $spreadsheetId, string $range, array $values): bool\n    {\n        Log::info(\"Escrevendo dados no Google Sheets: Planilha ID {$spreadsheetId}, Range: {$range}.\");\n        try {\n            $body = new \Google\\Service\\Sheets\\ValueRange([\n                \'values\' => $values\n            ]);\n            $params = [\n                \'valueInputOption\' => \'RAW\'\n            ];\n            $response = $this->sheetsService->spreadsheets_values->update($spreadsheetId, $range, $body, $params);\n            return $response->getUpdatedCells() > 0;\n        } catch (\\Exception $e) {\n            Log::error(\"Falha ao escrever dados no Google Sheets: \" . $e->getMessage());\n            throw $e;\n        }\n    }\n\n    /**\n     * Anexa uma linha de dados a uma planilha.\n     *\n     * @param string $spreadsheetId O ID da planilha.\n     * @param string $sheetName O nome da aba da planilha.\n     * @param array $row A linha de dados a ser anexada.\n     * @return bool\n     * @throws \\Exception Se o anexo falhar.\n     */\n    public function appendSheetRow(string $spreadsheetId, string $sheetName, array $row): bool\n    {\n        Log::info(\"Anexando linha ao Google Sheets: Planilha ID {$spreadsheetId}, Aba: {$sheetName}.\");\n        try {\n            $body = new \Google\\Service\\Sheets\\ValueRange([\n                \'values\' => [$row]\n            ]);\n            $params = [\n                \'valueInputOption\' => \'RAW\'\n            ];\n            $response = $this->sheetsService->spreadsheets_values->append($spreadsheetId, $sheetName, $body, $params);\n            return $response->getUpdates()->getUpdatedCells() > 0;\n        } catch (\\Exception $e) {\n            Log::error(\"Falha ao anexar linha ao Google Sheets: \" . $e->getMessage());\n            throw $e;\n        }\n    }\n}\n